<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>
        데이터 시각화
    </title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet" />
    <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
    <!-- Nucleo Icons -->
    <link href="../static/assets/css/nucleo-icons.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link href="../static/assets/css/black-dashboard.css?v=1.0.0" rel="stylesheet" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <style>
        .row3 {
            height: 550px;
        }
        .row4 {
            height: 550px;
        }
        .row5 {
            height: 650px;
        }
        .row6 {
            height: 650px;
        }
        .row7 {
            height: 650px;
        }
        .col-container {
            display: flex;
            width: 100%;
        }
        .col {
            flex: 1;
            display: table-cell;
            padding: 16px;
        }
        .col3_1 {
            height: 500px;
        }
        .col3_2 {
            height: 500px;
        }
        .col4_1 {
            height: 500px;
        }
        .col4_2 {
            height: 500px;
        }
        .col5_1 {
            height: 600px;
        }
        .col5_2 {
            height: 600px;
        }
        .col6_1 {
            height: 600px;
        }
        .col6_2 {
            height: 600px;
        }
        .col7_1 {
            height: 600px;
        }
        .col7_2 {
            height: 600px;
        }
        .legend rect {
            position: relative;
            fill:white;
            stroke:black;
            opacity:0.8;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="sidebar">
            <ul class="nav">
                <li>
                    <a href="./">
                        <i class="tim-icons icon-notes"></i>
                            <p>Introduction</p>
                    </a>
                </li>
                <li>
                    <a href="./fileUpload">
                        <i class="tim-icons icon-cloud-upload-94"></i>
                            <p>File Upload</p>
                    </a>
                </li>
                <li>
                    <a href="./machineLearning">
                        <i class="tim-icons icon-spaceship"></i>
                            <p>Machine Learning</p>
                    </a>
                </li>
                <li class="active ">
                    <a href="./visualization">
                        <i class="tim-icons icon-molecule-40"></i>
                            <p>Data Visualization</p>
                    </a>
                </li>
            </ul>
        </div>
        <div class="main-panel">
            <div class="content">
                <div class="row1">
                    <div class="col-12">
                        <div class="card card-chart">
                            <div class="card-header ">
                                <div class="row">
                                    <div class="col-sm-6 text-left">
                                        <h4 class="card-category" style="font-size:14px">Daumsoft AI LAB</h4>
                                        <h2 class="card-title">Visualization</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row2">
                    <div class="col-12">
                        {% if visualization == 'embedding_and_visualization' %}

                            <div class="row" style="background-color:mediumpurple">
                                    <div><h3>Train Set Embedding</h3></div>
                                    <div class="col" id="area1"></div>
                            </div>
                            <div class="row" style="background-color:mediumpurple">
                                    <div><h3>Test Set Embedding</h3></div>
                                    <div class="col" id="area2"></div>
                            </div>

                        {% elif visualization == 'embedding_and_machineLearning_visualization' %}

                            <div class="row3" style="background-color:#efbbff">
                                <div class="col-container">
                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">평가지표(훈련)</h3>
                                        <div class="col3_1" id="area3"></div>
                                    </div>

                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">평가지표(테스트)</h3>
                                        <div class="col3_2" id="area4"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row4" style="background-color:#d896ff">
                                <div class="col-container">
                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">오차행렬(훈련)</h3>
                                        <div class="col4_1" id="area5"></div>
                                    </div>

                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">오차행렬(테스트)</h3>
                                        <div class="col4_2" id="area6"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row5" style="background-color:#be29ec">
                                <div class="col-container">
                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">임베딩 방식 분포도(훈련)</h3>
                                        <div class="col5_1" id="area7"></div>
                                    </div>

                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">임베딩 방식 분포도(테스트)</h3>
                                        <div class="col5_2" id="area8"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row6" style="background-color:#800080">
                                <div class="col-container">
                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">분류 모델 예측 분포도(훈련)</h3>
                                        <div class="col6_1" id="area9"></div>
                                    </div>

                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">분류 모델 예측 분포도(테스트)</h3>
                                        <div class="col6_2" id="area10"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row6" style="background-color:#660066">
                                <div class="col-container">
                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">예측 결과 분포도(훈련)</h3>
                                        <div class="col7_1" id="area11"></div>
                                    </div>

                                    <div class="col">
                                        <h3 class="card-category" style="font-size:14px">예측 결과 분포도(테스트)</h3>
                                        <div class="col7_2" id="area12"></div>
                                    </div>
                                </div>
                            </div>

                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {#  임베딩 된 훈련 데이터의 시각화  #}
    <script class="a1">
        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 40, left: 50},
            width = 800 - margin.left - margin.right,
            height = 800 - margin.top - margin.bottom;

        // append the SVg object to the body of the page
        var SVG = d3.select("#area1")
            .style("background-color", "none")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")")

        // Add the black box around the chart
        SVG
            .append("rect")
            .attr("x",0)
            .attr("y",0)
            .attr("height", height)
            .attr("width", width)
            .style("fill", "none")
            .style("stroke", "white")
            .style("stroke-width", 2)
            .style("opacity", 0.6)

        //Read the data
        d3.csv("http://127.0.0.1:8080/embedding_and_visualization_train", function(data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r0 }) - 2, d3.max(data, function(d) { return d.r0 })])
                .range([0, width])
                .nice()

            SVG.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r1 }) - 2, d3.max(data, function(d) { return d.r1 })])
                .range([height, 0])
                .nice()

            SVG.append("g")
                .call(d3.axisLeft(y))

            // Add X axis label:
            SVG.append("text")
                .attr("text-anchor", "end")
                .attr("x", width)
                .attr("y", height + margin.top + 30)
                .text("dimension 0")
                .style("fill", "white")

            // Y axis label:
            SVG.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left+20)
                .attr("x", -margin.top)
                .text("dimension 1")
                .style("fill", "white")

            // Customization
            SVG.selectAll(".tick line").attr("stroke", "white").style("stroke-width", 1)
            SVG.selectAll(".tick text").attr("stroke", "white").style("stroke-width", 0.2).style("font-size", 13)

            var target_names = new Set();

            for (var i = 0; i < data.length; i++) {
                target_names.add(data[i]['target'])
            }
            target_names = Array.from(target_names).sort();

            var color = d3.scaleOrdinal()
                .domain(target_names)
                .range(d3.schemeSet1)

            // Add dots
            SVG.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.r0); } )
                .attr("cy", function (d) { return y(d.r1); } )
                .attr("r", 3)
                .attr("data-legend",function(d) { return d.target})
                .style("fill", function (d) { return color(d.target) } )

            var keys = Array.from(target_names)

            SVG.append("g")
                .selectAll("legend")
                .data(keys)
                .enter()
                .append("circle")
                    .attr("cx", -margin.left + 70)
                    .attr("cy", function(d, i) { return 15 + i * 25 })
                    .attr("r", 3)
                    .style("fill", function(d) { return color(d) })

            SVG.append("g")
                .selectAll("labels")
                .data(keys)
                .enter()
                .append("text")
                    .attr("x", -margin.left + 80)
                    .attr("y", function(d, i) { return 15 + i * 25 })
                    .style("fill", function(d) { return color(d) })
                    .text(function(d) { return d })
                    .attr("text-anchor", "left")
                    .style("alignment-baseline", "middle")
        })
    </script>
    {#  임베딩 된 테스트 데이터의 시각화  #}
    <script class="a2">
        // set the dimensions and margins of the graph
        var margin2 = {top: 10, right: 30, bottom: 40, left: 50},
            width2 = 800 - margin2.left - margin2.right,
            height2 = 800 - margin2.top - margin2.bottom;

        // append the SVg object to the body of the page
        var SVG2 = d3.select("#area2")
            .style("background-color", "none")
            .append("svg")
            .attr("width", width2 + margin2.left + margin2.right)
            .attr("height", height2 + margin2.top + margin2.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin2.left + "," + margin2.top + ")")

        // Add the black box around the chart
        SVG2
            .append("rect")
            .attr("x",0)
            .attr("y",0)
            .attr("height", height2)
            .attr("width", width2)
            .style("fill", "none")
            .style("stroke", "white")
            .style("stroke-width", 2)
            .style("opacity", 0.6)

        //Read the data
        d3.csv("http://127.0.0.1:8080/embedding_and_visualization_test", function(data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([-3, 8])
                .range([0, width2])
                .nice()

            SVG2.append("g")
                .attr("transform", "translate(0," + height2 + ")")
                .call(d3.axisBottom(x))

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([-3, 8])
                .range([height2, 0])
                .nice()

            SVG2.append("g")
                .call(d3.axisLeft(y))

            // Add X axis label:
            SVG2.append("text")
                .attr("text-anchor", "end")
                .attr("x", width2)
                .attr("y", height2 + margin2.top + 30)
                .text("dimension 0")
                .style("fill", "white")

            // Y axis label:
            SVG2.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin2.left+20)
                .attr("x", -margin2.top)
                .text("dimension 1")
                .style("fill", "white")

            // Customization
            SVG2.selectAll(".tick line").attr("stroke", "white").style("stroke-width", 1)
            SVG2.selectAll(".tick text").attr("stroke", "white").style("stroke-width", 0.2).style("font-size", 13)

            var target_names = new Set();

            for (var i = 0; i < data.length; i++) {
                target_names.add(data[i]['target'])
            }
            target_names = Array.from(target_names).sort();

            var color = d3.scaleOrdinal()
                .domain(target_names)
                .range(d3.schemeSet1)

            // Add dots
            SVG2.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.r0); } )
                .attr("cy", function (d) { return y(d.r1); } )
                .attr("r", 3)
                .attr("data-legend",function(d) { return d.target})
                .style("fill", function (d) { return color(d.target) } )

            var keys = Array.from(target_names)

            SVG2.append("g")
                .selectAll("legend")
                .data(keys)
                .enter()
                .append("circle")
                    .attr("cx", -margin2.left + 70)
                    .attr("cy", function(d, i) { return 15 + i * 25 })
                    .attr("r", 3)
                    .style("fill", function(d) { return color(d) })

            SVG2.append("g")
                .selectAll("labels")
                .data(keys)
                .enter()
                .append("text")
                    .attr("x", -margin2.left + 80)
                    .attr("y", function(d, i) { return 15 + i * 25 })
                    .style("fill", function(d) { return color(d) })
                    .text(function(d) { return d })
                    .attr("text-anchor", "left")
                    .style("alignment-baseline", "middle")
        })
    </script>
    {#  임베딩 및 머신러닝 전의 훈련 데이터의 평가 지표  #}
    <script class="a3">
        var margin3 = {top: 10, right: 30, bottom: 40, left: 50},
            width3 = 450 - margin3.left - margin3.right,
            height3 = 450 - margin3.top - margin3.bottom;

        var svg3 = d3.select("#area3")
            .append("svg")
            .attr("width", width3 + margin3.left + margin3.right)
            .attr("height", height + margin3.top + margin3.bottom)
            .append("g")
            .attr("transform", "translate(" + margin3.left + "," + margin3.top + ")");

        d3.csv("http://127.0.0.1:8080/metrics_score_train", function(data) {

            var x = d3.scaleBand()
                .range([0, width3])
                .domain(data.map(function(d) { return d.Metrics; }))
                .padding(0.2);

            svg3.append("g")
                .attr("transform", "translate(0," + height3 + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(10, 0)rotate(-45)")
                .style("text-anchor", "end")

            var y = d3.scaleLinear()
                .domain([0, 1.0])
                .range([height3, 0]);

            svg3.append("g")
                .call(d3.axisLeft(y));

            var color = d3.scaleOrdinal()
                .range([`#dc6750`, `#c5dc50`, `#50c5dc`, `#6750dc`])

            var tooltip = d3.select("#a3")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("width", "80px")

            var mouseover = function(d) {
                tooltip
                .style("opacity", 1)
                d3.select(this)
                .style("stroke", "black")
                .style("opacity", 1)
            }

            var mousemove = function(d) {
                tooltip.html("score: " + d.Score)
                .style("left", (d3.mouse(this)[0]+70) + "px")
                .style("top", (d3.mouse(this)[1]) + "px")
            }

            var mouseleave = function(d) {
                tooltip.style("opacity", 0)
                d3.select(this)
                .style("stroke", "none")
                .style("opacity", 0.8)
            }

            svg3.selectAll("mybar")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d) { return x(d.Metrics); })
                .attr("width", x.bandwidth())
                .attr("fill", "#69b3a2")
                .attr("height", function(d) { return height3 - y(0); })
                .attr("y", function(d) { return y(0); })

            svg3.selectAll("rect")
                .attr("y", function(d) { return y(d.Score); })
                .attr("height", function(d) { return height3 - y(d.Score); })
                .attr("width", x.bandwidth())
                .attr("fill", function(d) { return color(d.Metrics); })
                .attr("stroke", "grey")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)

            svg3.selectAll("text")
                .data(data, function (d) { return d})
                .enter()
                .append("text")
                .text(function (d) {return d.Score;})
                .attr("x", function(d) { return x(d.Metrics) + 18;})
                .attr("y", function(d) { return y(d.Score) - 5;})
                .style("font-size", "13px")
        })
    </script>
    {#  임베딩 및 머신러닝 후의 훈련 데이터의 평가 지표  #}
    <script class="a4">
        var margin4 = {top: 10, right: 30, bottom: 40, left: 50},
            width4 = 450 - margin4.left - margin4.right,
            height4 = 450 - margin4.top - margin4.bottom;

        var svg4 = d3.select("#area4")
            .append("svg")
            .attr("width", width4 + margin4.left + margin4.right)
            .attr("height", height4 + margin4.top + margin4.bottom)
            .append("g")
            .attr("transform", "translate(" + margin4.left + "," + margin4.top + ")");

        d3.csv("http://127.0.0.1:8080/metrics_score_test", function(data) {

            var x = d3.scaleBand()
                .range([0, width4])
                .domain(data.map(function(d) { return d.Metrics; }))
                .padding(0.2);

            svg4.append("g")
                .attr("transform", "translate(0," + height4 + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(10, 0)rotate(-45)")
                .style("text-anchor", "end")

            var y = d3.scaleLinear()
                .domain([0, 1.0])
                .range([height4, 0]);

            svg4.append("g")
                .call(d3.axisLeft(y));

            var color = d3.scaleOrdinal()
                .range([`#dc6750`, `#c5dc50`, `#50c5dc`, `#6750dc`])

            var tooltip = d3.select("#a4")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("width", "80px")

            var mouseover = function(d) {
                tooltip
                .style("opacity", 1)
                d3.select(this)
                .style("stroke", "black")
                .style("opacity", 1)
            }

            var mousemove = function(d) {
                tooltip.html("score: " + d.Score)
                .style("left", (d3.mouse(this)[0]+70) + "px")
                .style("top", (d3.mouse(this)[1]) + "px")
            }

            var mouseleave = function(d) {
                tooltip.style("opacity", 0)
                d3.select(this)
                .style("stroke", "none")
                .style("opacity", 0.8)
            }

            svg4.selectAll("mybar")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d) { return x(d.Metrics); })
                .attr("width", x.bandwidth())
                .attr("fill", "#69b3a2")
                .attr("height", function(d) { return height4 - y(0); })
                .attr("y", function(d) { return y(0); })

            svg4.selectAll("rect")
                .attr("y", function(d) { return y(d.Score); })
                .attr("height", function(d) { return height4 - y(d.Score); })
                .attr("width", x.bandwidth())
                .attr("fill", function(d) { return color(d.Metrics); })
                .attr("stroke", "grey")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)

            svg4.selectAll("text")
                .data(data, function (d) { return d})
                .enter()
                .append("text")
                .text(function (d) {return d.Score;})
                .attr("x", function(d) { return x(d.Metrics) + 18;})
                .attr("y", function(d) { return y(d.Score) - 5;})
                .style("font-size", "13px")
        })
    </script>
    {#  임베딩 및 머신러닝 전의 훈련 데이터의 오차행렬  #}
    <script class="a5">
        var margin5 = {top: 10, right: 30, bottom: 40, left: 50},
            width5 = 450 - margin5.left - margin5.right,
            height5 = 450 - margin5.top - margin5.bottom;

        var svg5 = d3.select("#area5")
            .append("svg")
            .attr("width", width5 + margin5.left + margin5.right)
            .attr("height", height5 + margin5.top + margin5.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin5.left + "," + margin5.top + ")");

        d3.csv("http://127.0.0.1:8080/confusion_matrix_train", function(data) {

            var myGroups = d3.map(data, function(d){return d.group;}).keys()
            var myVars = d3.map(data, function(d){return d.variable;}).keys()

            var x = d3.scaleBand()
                .range([0, width4])
                .domain(myGroups)
                .padding(0.05);

            svg5.append("g")
                .style("font-size", 15)
                .attr("transform", "translate(0," + height5 + ")")
                .call(d3.axisBottom(x).tickSize(0))
                .select(".domain").remove()

            var y = d3.scaleBand()
                .range([height5, 0])
                .domain(myVars)
                .padding(0.05);

            svg5.append("g")
                .style("font-size", 15)
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove()

            var myColor = d3.scaleSequential()
                .interpolator(d3.interpolateRainbow)
                .domain([1, 1000])

            var tooltip = d3.select("#a5")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")
                .style("width", "80px")

            var mouseover = function(d) {
                tooltip.style("opacity", 1)
                d3.select(this)
                .style("stroke", "black")
                .style("opacity", 1)
            }

            var mousemove = function(d) {
                tooltip.html(d.value)
                .style("left", (d3.mouse(this)[0]+70) + "px")
                .style("top", (d3.mouse(this)[1]) + "px")
            }
            var mouseleave = function(d) {
                tooltip.style("opacity", 0)

            d3.select(this)
                .style("stroke", "none")
                .style("opacity", 0.8)
            }

            svg5.selectAll()
                .data(data, function (d) {return d.group+':'+d.variable;})
                .enter()
                .append("rect")
                .attr("x", function (d) { return x(d.group) })
                .attr("y", function (d) { return y(d.variable) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth() )
                .attr("height", y.bandwidth() )
                .style("fill", function(d) { return myColor(d.value)} )
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)

            svg5.selectAll("text")
                .data(data, function (d) { return d})
                .enter()
                .append("text")
                .text(function (d) {return d.value;})
                .attr("x", function (d) { return x(d.group) + 15})
                .attr("y", function (d) { return y(d.variable) + 35})
        })

    </script>

    {#  임베딩 및 머신러닝 후의 훈련 데이터의 오차행렬  #}
    <script class="a6">
        var margin6 = {top: 10, right: 30, bottom: 40, left: 50},
            width6 = 450 - margin6.left - margin6.right,
            height6 = 450 - margin6.top - margin6.bottom;

        var svg6 = d3.select("#area6")
            .append("svg")
            .attr("width", width6 + margin4.left + margin6.right)
            .attr("height", height6 + margin6.top + margin6.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin6.left + "," + margin6.top + ")");

        d3.csv("http://127.0.0.1:8080/confusion_matrix_test", function(data) {

            var myGroups = d3.map(data, function(d){return d.group;}).keys()
            var myVars = d3.map(data, function(d){return d.variable;}).keys()

            var x = d3.scaleBand()
                .range([0, width6])
                .domain(myGroups)
                .padding(0.05);

            svg6.append("g")
                .style("font-size", 15)
                .attr("transform", "translate(0," + height6 + ")")
                .call(d3.axisBottom(x).tickSize(0))
                .select(".domain").remove()

            var y = d3.scaleBand()
                .range([height6, 0])
                .domain(myVars)
                .padding(0.05);

            svg6.append("g")
                .style("font-size", 15)
                .call(d3.axisLeft(y).tickSize(0))
                .select(".domain").remove()

            var myColor = d3.scaleSequential()
                .interpolator(d3.interpolateCool)
                .domain([1, 1000])

            var tooltip = d3.select("#heatmap")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")
                .style("width", "80px")

            var mouseover = function(d) {
                tooltip.style("opacity", 1)
                d3.select(this)
                .style("stroke", "black")
                .style("opacity", 1)
            }

            var mousemove = function(d) {
                tooltip.html(d.value)
                .style("left", (d3.mouse(this)[0]+70) + "px")
                .style("top", (d3.mouse(this)[1]) + "px")
            }
            var mouseleave = function(d) {
                tooltip.style("opacity", 0)

            d3.select(this)
                .style("stroke", "none")
                .style("opacity", 0.8)
            }

            svg6.selectAll()
                .data(data, function(d) {return d.group+':'+d.variable;})
                .enter()
                .append("rect")
                .attr("x", function(d) { return x(d.group) })
                .attr("y", function(d) { return y(d.variable) })
                .attr("rx", 4)
                .attr("ry", 4)
                .attr("width", x.bandwidth() )
                .attr("height", y.bandwidth() )
                .style("fill", function(d) { return myColor(d.value)} )
                .style("stroke-width", 4)
                .style("stroke", "none")
                .style("opacity", 0.8)
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)

            svg6.selectAll("text")
                .data(data, function (d) { return d})
                .enter()
                .append("text")
                .text(function (d) {return d.value;})
                .attr("x", function (d) { return x(d.group) + 15})
                .attr("y", function (d) { return y(d.variable) + 35})
        })
    </script>

    {#  훈련 데이터의 임베딩  #}
    <script class="a7">
        // set the dimensions and margins of the graph
        var margin7 = {top: 10, right: 30, bottom: 40, left: 50},
            width7 = 550 - margin7.left - margin7.right,
            height7 = 550 - margin7.top - margin7.bottom;

        // append the SVg object to the body of the page
        var SVG7 = d3.select("#area7")
            .style("background-color", "none")
            .append("svg")
            .attr("width", width7 + margin7.left + margin7.right)
            .attr("height", height7+ margin7.top + margin7.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin7.left + "," + margin7.top + ")")

        // Add the black box around the chart
        SVG7
            .append("rect")
            .attr("x",0)
            .attr("y",0)
            .attr("height", height7)
            .attr("width", width7)
            .style("fill", "none")
            .style("stroke", "black")
            .style("stroke-width", 2)
            .style("opacity", 0.6)

        //Read the data
        d3.csv("http://127.0.0.1:8080/embedding_and_visualization_train", function(data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r0 }) - 2, d3.max(data, function(d) { return d.r0 })])
                .range([0, width7])
                .nice()

            SVG7.append("g")
                .attr("transform", "translate(0," + height7 + ")")
                .call(d3.axisBottom(x))

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r1 }) - 2, d3.max(data, function(d) { return d.r1 })])
                .range([height7, 0])
                .nice()

            SVG7.append("g")
                .call(d3.axisLeft(y))

            // Add X axis label:
            SVG7.append("text")
                .attr("text-anchor", "end")
                .attr("x", width7)
                .attr("y", height7 + margin7.top + 30)
                .text("dimension 0")
                .style("font-size", "15px")
                .style("fill", "black")

            // Y axis label:
            SVG7.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin7.left+20)
                .attr("x", -margin7.top)
                .text("dimension 1")
                .style("font-size", "15px")
                .style("fill", "black")

            // Customization
            SVG7.selectAll(".tick line").attr("stroke", "black").style("stroke-width", 1)
            SVG7.selectAll(".tick text").attr("stroke", "black").style("stroke-width", 1).style("font-size", 13)

            var target_names = new Set();

            for (var i = 0; i < data.length; i++) {
                target_names.add(data[i]['target'])
            }
            target_names = Array.from(target_names).sort();

            var color = d3.scaleOrdinal()
                .domain(target_names)
                .range(d3.schemeCategory10)

            // Add dots
            SVG7.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.r0); } )
                .attr("cy", function (d) { return y(d.r1); } )
                .attr("r", 4)
                .attr("data-legend",function(d) { return d.target})
                .style("fill", function (d) { return color(d.target) } )
                .style("stroke", "black")
                .style("stroke-width", 1)

            var keys = Array.from(target_names)

            SVG7.append("g")
                .selectAll("legend")
                .data(keys)
                .enter()
                .append("circle")
                    .attr("cx", -margin7.left + 70)
                    .attr("cy", function(d, i) { return 15 + i * 25 })
                    .attr("r", 4)
                    .style("fill", function(d) { return color(d) })
                    .attr("stroke", "black")
                    .style("stroke-width", 1)

            SVG7.append("g")
                .selectAll("labels")
                .data(keys)
                .enter()
                .append("text")
                    .attr("x", -margin7.left + 80)
                    .attr("y", function(d, i) { return 15 + i * 25 })
                    .style("fill", function(d) { return color(d) })
                    .text(function(d) { return d })
                    .attr("text-anchor", "left")
                    .attr("stroke", "black")
                    .style("stroke-width", 1)
                    .style("alignment-baseline", "middle")
        })
    </script>
    {#  테스트 데이터 임베딩  #}
    <script class="a8">
        // set the dimensions and margins of the graph
        var margin8 = {top: 10, right: 30, bottom: 40, left: 50},
            width8 = 550 - margin8.left - margin8.right,
            height8 = 550 - margin8.top - margin8.bottom;

        // append the SVg object to the body of the page
        var SVG8 = d3.select("#area8")
            .style("background-color", "none")
            .append("svg")
            .attr("width", width8 + margin8.left + margin8.right)
            .attr("height", height8+ margin8.top + margin8.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin8.left + "," + margin8.top + ")")

        // Add the black box around the chart
        SVG8
            .append("rect")
            .attr("x",0)
            .attr("y",0)
            .attr("height", height8)
            .attr("width", width8)
            .style("fill", "none")
            .style("stroke", "black")
            .style("stroke-width", 2)
            .style("opacity", 0.6)

        //Read the data
        d3.csv("http://127.0.0.1:8080/embedding_and_visualization_test", function(data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r0 }) - 2, d3.max(data, function(d) { return d.r0 })])
                .range([0, width8])
                .nice()

            SVG8.append("g")
                .attr("transform", "translate(0," + height8 + ")")
                .call(d3.axisBottom(x))

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r1 }) - 2, d3.max(data, function(d) { return d.r1 })])
                .range([height8, 0])
                .nice()

            SVG8.append("g")
                .call(d3.axisLeft(y))

            // Add X axis label:
            SVG8.append("text")
                .attr("text-anchor", "end")
                .attr("x", width8)
                .attr("y", height8 + margin8.top + 30)
                .text("dimension 0")
                .style("font-size", "15px")
                .style("fill", "black")

            // Y axis label:
            SVG8.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin8.left+10)
                .attr("x", -margin8.top)
                .text("dimension 1")
                .style("font-size", "15px")
                .style("fill", "black")

            // Customization
            SVG8.selectAll(".tick line").attr("stroke", "black").style("stroke-width", 1)
            SVG8.selectAll(".tick text").attr("stroke", "black").style("stroke-width", 1).style("font-size", 13)

            var target_names = new Set();

            for (var i = 0; i < data.length; i++) {
                target_names.add(data[i]['target'])
            }
            target_names = Array.from(target_names).sort();

            var color = d3.scaleOrdinal()
                .domain(target_names)
                .range(d3.schemeCategory10)

            // Add dots
            SVG8.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.r0); } )
                .attr("cy", function (d) { return y(d.r1); } )
                .attr("r", 4)
                .attr("data-legend",function(d) { return d.target})
                .style("fill", function (d) { return color(d.target) } )
                .style("stroke", "black")
                .style("stroke-width", 1)

            var keys = Array.from(target_names)

            SVG8.append("g")
                .selectAll("legend")
                .data(keys)
                .enter()
                .append("circle")
                    .attr("cx", -margin8.left + 70)
                    .attr("cy", function(d, i) { return 15 + i * 25 })
                    .attr("r", 4)
                    .style("fill", function(d) { return color(d) })
                    .attr("stroke", "black")
                    .style("stroke-width", 1)

            SVG8.append("g")
                .selectAll("labels")
                .data(keys)
                .enter()
                .append("text")
                    .attr("x", -margin8.left + 80)
                    .attr("y", function(d, i) { return 15 + i * 25 })
                    .style("fill", function(d) { return color(d) })
                    .text(function(d) { return d })
                    .attr("text-anchor", "left")
                    .attr("stroke", "black")
                    .style("stroke-width", 1)
                    .style("alignment-baseline", "middle")
        })
    </script>

    {#  분류 모델 예측 분포도(훈련)  #}
    <script class="a9">
        // set the dimensions and margins of the graph
        var margin9 = {top: 10, right: 30, bottom: 40, left: 50},
            width9 = 550 - margin9.left - margin9.right,
            height9 = 550 - margin9.top - margin9.bottom;

        // append the SVg object to the body of the page
        var SVG9 = d3.select("#area9")
            .style("background-color", "none")
            .append("svg")
            .attr("width", width9 + margin9.left + margin9.right)
            .attr("height", height9 + margin9.top + margin9.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin9.left + "," + margin9.top + ")")

        // Add the black box around the chart
        SVG9
            .append("rect")
            .attr("x",0)
            .attr("y",0)
            .attr("height", height9)
            .attr("width", width9)
            .style("fill", "none")
            .style("stroke", "black")
            .style("stroke-width", 2)
            .style("opacity", 0.6)

        //Read the data
        d3.csv("http://127.0.0.1:8080/embedding_and_machinelearning_visualization_train", function(data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r0 }) - 2, d3.max(data, function(d) { return d.r0 })])
                .range([0, width9])
                .nice()

            SVG9.append("g")
                .attr("transform", "translate(0," + height9 + ")")
                .call(d3.axisBottom(x))

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r1 }) - 2, d3.max(data, function(d) { return d.r1 })])
                .range([height9, 0])
                .nice()

            SVG9.append("g")
                .call(d3.axisLeft(y))

            // Add X axis label:
            SVG9.append("text")
                .attr("text-anchor", "end")
                .attr("x", width9)
                .attr("y", height9 + margin9.top + 30)
                .text("dimension 0")
                .style("font-size", "15px")
                .style("fill", "black")

            // Y axis label:
            SVG9.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin9.left+20)
                .attr("x", -margin9.top)
                .text("dimension 1")
                .style("font-size", "15px")
                .style("fill", "black")

            // Customization
            SVG9.selectAll(".tick line").attr("stroke", "black").style("stroke-width", 1)
            SVG9.selectAll(".tick text").attr("stroke", "black").style("stroke-width", 1).style("font-size", 13)

            var target_names = new Set();

            for (var i = 0; i < data.length; i++) {
                target_names.add(data[i]['target'])
            }
            target_names = Array.from(target_names).sort();

            var color = d3.scaleOrdinal()
                .domain(target_names)
                .range(d3.schemeCategory10)

            // Add dots
            SVG9.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.r0); } )
                .attr("cy", function (d) { return y(d.r1); } )
                .attr("r", 4)
                .attr("data-legend",function(d) { return d.pred})
                .style("fill", function (d) { return color(d.pred) } )
                .style("stroke", "black")
                .style("stroke-width", 1)

            var keys = Array.from(target_names)

            SVG9.append("g")
                .selectAll("legend")
                .data(keys)
                .enter()
                .append("circle")
                    .attr("cx", -margin9.left + 70)
                    .attr("cy", function(d, i) { return 15 + i * 25 })
                    .attr("r", 4)
                    .style("fill", function(d) { return color(d) })
                    .attr("stroke", "black")
                    .style("stroke-width", 1)

            SVG9.append("g")
                .selectAll("labels")
                .data(keys)
                .enter()
                .append("text")
                    .attr("x", -margin9.left + 80)
                    .attr("y", function(d, i) { return 15 + i * 25 })
                    .style("fill", function(d) { return color(d) })
                    .text(function(d) { return d })
                    .attr("text-anchor", "left")
                    .attr("stroke", "black")
                    .style("stroke-width", 1)
                    .style("alignment-baseline", "middle")
        })
    </script>
    {#  분류 모델 예측 분포도(테스트)  #}
    <script class="a10">
        // set the dimensions and margins of the graph
        var margin10 = {top: 10, right: 30, bottom: 40, left: 50},
            width10 = 550 - margin10.left - margin10.right,
            height10 = 550 - margin10.top - margin10.bottom;

        // append the SVg object to the body of the page
        var SVG10 = d3.select("#area8")
            .style("background-color", "none")
            .append("svg")
            .attr("width", width10 + margin10.left + margin10.right)
            .attr("height", height10 + margin10.top + margin10.bottom)
            .append("g")
            .attr("transform",
            "translate(" + margin10.left + "," + margin10.top + ")")

        // Add the black box around the chart
        SVG10
            .append("rect")
            .attr("x",0)
            .attr("y",0)
            .attr("height", height10)
            .attr("width", width10)
            .style("fill", "none")
            .style("stroke", "black")
            .style("stroke-width", 2)
            .style("opacity", 0.6)

        //Read the data
        d3.csv("http://127.0.0.1:8080/embedding_and_machinelearning_visualization_test", function(data) {

            // Add X axis
            var x = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r0 }) - 2, d3.max(data, function(d) { return d.r0 })])
                .range([0, width10])
                .nice()

            SVG10.append("g")
                .attr("transform", "translate(0," + height10 + ")")
                .call(d3.axisBottom(x))

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([d3.min(data, function(d) { return d.r1 }) - 2, d3.max(data, function(d) { return d.r1 })])
                .range([height10, 0])
                .nice()

            SVG10.append("g")
                .call(d3.axisLeft(y))

            // Add X axis label:
            SVG10.append("text")
                .attr("text-anchor", "end")
                .attr("x", width10)
                .attr("y", height10 + margin10.top + 30)
                .text("dimension 0")
                .style("font-size", "15px")
                .style("fill", "black")

            // Y axis label:
            SVG10.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin10.left+10)
                .attr("x", -margin10.top)
                .text("dimension 1")
                .style("font-size", "15px")
                .style("fill", "black")

            // Customization
            SVG10.selectAll(".tick line").attr("stroke", "black").style("stroke-width", 1)
            SVG10.selectAll(".tick text").attr("stroke", "black").style("stroke-width", 1).style("font-size", 13)

            var target_names = new Set();

            for (var i = 0; i < data.length; i++) {
                target_names.add(data[i]['target'])
            }
            target_names = Array.from(target_names).sort();

            var color = d3.scaleOrdinal()
                .domain(target_names)
                .range(d3.schemeCategory10)

            // Add dots
            SVG10.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.r0); } )
                .attr("cy", function (d) { return y(d.r1); } )
                .attr("r", 4)
                .attr("data-legend",function(d) { return d.pred})
                .style("fill", function (d) { return color(d.pred) } )
                .style("stroke", "black")
                .style("stroke-width", 1)

            var keys = Array.from(target_names)

            SVG10.append("g")
                .selectAll("legend")
                .data(keys)
                .enter()
                .append("circle")
                    .attr("cx", -margin10.left + 70)
                    .attr("cy", function(d, i) { return 15 + i * 25 })
                    .attr("r", 4)
                    .style("fill", function(d) { return color(d) })
                    .attr("stroke", "black")
                    .style("stroke-width", 1)

            SVG10.append("g")
                .selectAll("labels")
                .data(keys)
                .enter()
                .append("text")
                    .attr("x", -margin10.left + 80)
                    .attr("y", function(d, i) { return 15 + i * 25 })
                    .style("fill", function(d) { return color(d) })
                    .text(function(d) { return d })
                    .attr("text-anchor", "left")
                    .attr("stroke", "black")
                    .style("stroke-width", 1)
                    .style("alignment-baseline", "middle")
        })
    </script>
</body>
</html>